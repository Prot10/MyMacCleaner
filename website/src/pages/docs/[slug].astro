---
import { getCollection, render } from 'astro:content';
import DocsLayout from '../../layouts/DocsLayout.astro';

export async function getStaticPaths() {
  const docs = await getCollection('docs');
  return docs.map((doc) => ({
    params: { slug: doc.id.replace('.md', '') },
    props: { doc }
  }));
}

const { doc } = Astro.props;
const { Content, headings } = await render(doc);

// Extract title from first H1 in content or use slug
const titleMatch = doc.body?.match(/^#\s+(.+)$/m);
const title = titleMatch ? titleMatch[1] : doc.id.replace('.md', '').replace(/-/g, ' ');
---

<DocsLayout title={title} headings={headings}>
  <Content />
</DocsLayout>
